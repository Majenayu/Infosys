# TrackSmart Deployment Guide for Render

This guide explains how to deploy the TrackSmart application as three separate services on Render.

## Overview

TrackSmart has been split into three independent services:
1. **User Service** (`user_app.py`) - User portal for tracking deliveries
2. **Delivery Partner Service** (`delivery_app.py`) - Delivery partner portal with QR scanning
3. **Company Service** (`company_app.py`) - Company portal with QR generation and management

## Prerequisites

- Render account
- MongoDB Atlas database (connection string provided)
- All three services use the same MongoDB database but operate independently

## Deployment Steps

### Method 1: Using Render Blueprint (Recommended)

1. **Upload the render.yaml file to your repository**
2. **Connect to Render**: Go to Render dashboard → "New" → "Blueprint"
3. **Repository**: Connect your GitHub repository containing the TrackSmart code
4. **Deploy**: Render will automatically deploy all three services based on the `render.yaml` configuration

### Method 2: Manual Deployment (Alternative)

Deploy each service individually:

#### User Service
1. Go to Render dashboard → "New" → "Web Service"
2. Connect your repository
3. Configure:
   - **Name**: `tracksmart-user`
   - **Runtime**: `Python 3`
   - **Build Command**: `pip install -r render_requirements.txt`
   - **Start Command**: `gunicorn --bind 0.0.0.0:$PORT --reuse-port user_app:app`
   - **Instance Type**: `Starter` (Free tier)

#### Delivery Partner Service
1. Go to Render dashboard → "New" → "Web Service"
2. Connect your repository
3. Configure:
   - **Name**: `tracksmart-delivery`
   - **Runtime**: `Python 3`
   - **Build Command**: `pip install -r render_requirements.txt`
   - **Start Command**: `gunicorn --bind 0.0.0.0:$PORT --reuse-port delivery_app:app`
   - **Instance Type**: `Starter` (Free tier)

#### Company Service
1. Go to Render dashboard → "New" → "Web Service"
2. Connect your repository
3. Configure:
   - **Name**: `tracksmart-company`
   - **Runtime**: `Python 3`
   - **Build Command**: `pip install -r render_requirements.txt`
   - **Start Command**: `gunicorn --bind 0.0.0.0:$PORT --reuse-port company_app:app`
   - **Instance Type**: `Starter` (Free tier)

## Environment Variables

Each service requires these environment variables:

```
SESSION_SECRET=your_secret_key_here (auto-generated by Render)
MONGODB_URI=mongodb+srv://in:in@in.hfxejxb.mongodb.net/?retryWrites=true&w=majority&appName=in
PORT=10000 (auto-set by Render)
```

## Service URLs

After deployment, you'll get three URLs:
- **User Service**: `https://tracksmart-user.onrender.com`
- **Delivery Service**: `https://tracksmart-delivery.onrender.com`  
- **Company Service**: `https://tracksmart-company.onrender.com`

## Features by Service

### User Service
- User registration and login
- Order tracking dashboard
- QR code access verification
- Customer care contact

### Delivery Partner Service
- Delivery partner registration and login
- QR code scanning
- Live location tracking
- Role-based functionality (Captain, Pilot, TC, Boy)

### Company Service
- Company registration and login
- QR code generation
- Order management dashboard
- Employee analytics
- Email notifications

## Database Collections

All services share the same MongoDB database with these collections:
- `companies` - Company registration data
- `users` - User registration data
- `delivery_partners` - Delivery partner data
- `locations` - QR code location data
- `{qr_id}` - Individual QR tracking collections
- `delivery_{email}` - Individual delivery partner collections

## Security Notes

- All passwords are stored in plain text (for demo purposes)
- In production, implement proper password hashing
- Use HTTPS in production (Render provides this automatically)
- Consider implementing JWT tokens for authentication
- Add rate limiting for API endpoints

## Monitoring

Each service includes:
- Health check endpoint (root URL)
- Detailed logging for debugging
- MongoDB connection monitoring
- Graceful error handling

## Troubleshooting

### Common Issues

1. **MongoDB Connection Failed**
   - Check `MONGODB_URI` environment variable
   - Verify MongoDB Atlas IP whitelist includes 0.0.0.0/0
   - Check database user permissions

2. **Service Won't Start**
   - Check build logs for Python dependency issues
   - Verify `render_requirements.txt` is in repository root
   - Check start command syntax

3. **Templates Not Found**
   - Ensure `templates/` folder is in repository
   - Check template file names match route references
   - Verify Flask app can find template directory

### Render-Specific Notes

- **Cold Starts**: Free tier services sleep after 15 minutes of inactivity
- **Build Time**: Initial builds may take 5-10 minutes
- **SSL**: Automatic HTTPS certificates provided
- **Logging**: View logs in Render dashboard under each service

## Scaling

For production use:
- Upgrade to paid plans for better performance
- Consider using Redis for session management
- Implement database connection pooling
- Add CDN for static assets
- Set up monitoring and alerting

## Support

For issues specific to:
- **TrackSmart Application**: Contact development team
- **Render Platform**: Check Render documentation or support
- **MongoDB**: Check MongoDB Atlas documentation